# Maintainer: Alexander Simonov <alex@simonov.me>
# Contributor: Kosta Welke <kosta@fillibach.de>
pkgname=forked-daapd
pkgver=21.0
pkgrel=1
pkgdesc="iTunes-compatible media server, originally intended as a rewrite of Firefly Media Server (mt-daapd)."
arch=('i686' 'x86_64')
url="https://github.com/ejurgensen/forked-daapd"
license=('GPL')
groups=()
depends=(pkg-config avahi sqlite3 ffmpeg confuse libevent mxml libgcrypt zlib libunistring flac taglib libplist libantlr3c libavl-for-forked-daapd)
makedepends=(gperf java-runtime)
optdepends=()
provides=()
conflicts=()
replaces=()
backup=(etc/forked-daapd.conf etc/avahi/services/forked-daapd.service)
options=()
install=forked-daapd.install
changelog=
source=(https://github.com/ejurgensen/forked-daapd/archive/$pkgver.tar.gz forked-daapd.install forked-daapd.avahi forked-daapd.service http://www.antlr3.org/download/antlr-3.4-complete.jar)
noextract=()
md5sums=('3cc1fd3b914e453924621e4f80e2b3d1'
         '9c8bf7589119045c20e951ab56d3e3b8'
         'c01fde6f40880fed6092c0830a5f232e'
         '95d2ecf654373747e6320a2c75a87c76'
         '1b91dea1c7d480b3223f7c8a9aa0e172')
sha1sums=('c1ee500bcf6df7f1cd8eca91ab45526fc145cb50'
          'a21a31d23469c36b3001e4ba3c8cedfb1ec97c9a'
          'a6f3c5ee05365481caaa569fe15ca34ffe4dc847'
          '5c24879397f75758bd2ef42a9d1b1ef36ec409ed'
          '5cab59d859caa6598e28131d30dd2e89806db57f')
sha256sums=('f27031fac493b540ea27aa063b3619697b5e39816104a221b4f66e884b73bb94'
            '963afb3c79468f718cfe0e93c9b6fe365df918d1a3bc7faa36bec8c1c6496f1c'
            '0efc8aac56d2b3a70d74c90a72595f3b685a30ee94a278880cd0cc4db35fa113'
            'b51231bb12af3b6daa427883b19c4f18e562ff0e8c3a434f1cce3a4e99e993e4'
            '9d3e866b610460664522520f73b81777b5626fb0a282a5952b9800b751550bf7')
sha384sums=('c420b48b35c7e86f4cdc432b1a764eb17d1aa8d26a59e61572b94a56c80d82e0ff394d70db9ae9f50782eda19974f479'
            '673f62a43d3c200d00bf832a801d895ee8a023ffbff9f59cc4aa8a1a5ffa70addd68b2be90db0807b15708380d198111'
            '36bdb6cfc389572f7f34658307b68f31d79ba9a5827eeee60c43f042f3d75d90c9d76e90840258e57e59c5c4d8d47d52'
            '86a6106898d19972ed2dfe56f56e773a4f40161615d5adbf219586643669008058f857e197e677a35f47aa2a5512335d'
            'a2fbecb5fae6af12adcfb3801624d4941e25e4b526794f7b9a713ae8b6873962ca36a74f9220d7e0057aaa89d5ca6d68')
sha512sums=('60ca02f8f829c83c2063574b1c2a55524638d00f2874acb189b14662d834e4e6016d5d4b2c54dc011e46dd5c6ec5c24ff8b8c462c85ab43977659356202b79b3'
            '25b631071001ce726dfc4684bd5c7e8c8fcfddf952de139b8277ce2cbdd49d3f4a6b8d2f22e68674849ff4bb3cd345402e64c86423d4dfca595478eb46076f19'
            '70da9a199ac821736ea6cd33455c14cf32ab5bc4b401dc31179dc6029c36fcb543810d0041f309fdcfd7be84d7d1f921b63a70993ad89b6f0c1ea06e51859dfb'
            'e1588ced89087de10005eb3477764e4deaa912f3d7817a0ee74b9d949ccb214fd4c0b57240770f5d68ac319fce1f20039f2b25b30e7446342e6a653ab4569b4b'
            '04be4dfba3a21f3ab9d9e439a64958bd8e844a9f151b798383bd9e0dd6ebc416783ae7cb1d1dbb27fb7288ab9756b13b8338cdb8ceb41a10949c852ad45ab1f2')

build() {
  OLD_PATH=$PATH
  export PATH="$srcdir:$PATH"
  echo "#!/bin/bash" > antlr3
  echo "exec java -cp $srcdir/antlr-3.4-complete.jar org.antlr.Tool \"\$@\"" >> antlr3
  chmod a+x ./antlr3
  cd "$srcdir/$pkgname-$pkgver"
  echo $PATH
  autoreconf -i
  ./configure --prefix=/usr --sysconfdir=/etc --localstatedir=/var --enable-flac --enable-musepack --enable-itunes
  make
  export PATH=$OLD_PATH
}

package() {
  cd "$srcdir/$pkgname-$pkgver"

  install -D -m644 $srcdir/forked-daapd.service $pkgdir/usr/lib/systemd/system/forked-daapd.service
  install -D -m644 $srcdir/forked-daapd.service $pkgdir/etc/avahi/services/forked-daapd.service
  make DESTDIR="$pkgdir/" install
}
